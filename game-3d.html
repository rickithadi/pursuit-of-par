<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Pursuit of Par - Enhanced 3D Golf Simulation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tpc-hole-styles.css">
    <style>
        .enhanced-game-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1rem;
            background: var(--cream);
            min-height: 100vh;
        }
        
        .dependency-error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fee2e2;
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.2);
            z-index: 10000;
            max-width: 400px;
        }
        
        .dependency-error h3 {
            color: #dc2626;
            margin-top: 0;
            margin-bottom: 1rem;
        }
        
        .dependency-error p {
            color: #7f1d1d;
            margin-bottom: 1rem;
        }
        
        .enhanced-header {
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .enhanced-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.08)"/><circle cx="60" cy="70" r="1" fill="rgba(255,255,255,0.06)"/></svg>');
            pointer-events: none;
        }
        
        .enhanced-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .enhanced-subtitle {
            font-size: 1.2rem;
            color: var(--gold);
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .performance-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        .performance-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .enhanced-layout {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 2rem;
        }
        
        .course-3d-area {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            position: relative;
        }
        
        .course-3d-viewport {
            width: 100%;
            height: 700px;
            border-radius: 8px;
            overflow: hidden;
            background: linear-gradient(135deg, #87ceeb 0%, #98fb98 100%);
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .viewport-overlay {
            position: absolute;
            top: 1rem;
            left: 1rem;
            right: 1rem;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .hole-info-3d {
            background: rgba(255,255,255,0.95);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            min-width: 200px;
        }
        
        .camera-controls {
            background: rgba(255,255,255,0.95);
            padding: 0.5rem;
            border-radius: 8px;
            display: flex;
            gap: 0.5rem;
        }
        
        .camera-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }
        
        .camera-btn:hover {
            background: var(--dark-green);
            transform: translateY(-1px);
        }
        
        .enhanced-panel {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            height: fit-content;
        }
        
        .game-mode-selector {
            background: var(--cream);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .mode-title {
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 1rem;
        }
        
        .mode-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .mode-option {
            padding: 0.75rem;
            background: var(--white);
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 0.9rem;
        }
        
        .mode-option:hover {
            border-color: var(--primary-green);
        }
        
        .mode-option.selected {
            background: var(--primary-green);
            color: var(--white);
            border-color: var(--gold);
        }
        
        .enhanced-controls {
            margin-bottom: 2rem;
        }
        
        .control-group {
            background: var(--cream);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        .control-group-title {
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .shot-power-control {
            margin: 1rem 0;
        }
        
        .power-meter {
            width: 100%;
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            margin: 1rem 0;
        }
        
        .power-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #FF5722);
            width: 75%;
            transition: width 0.3s ease;
        }
        
        .power-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray-medium);
            margin-top: 0.5rem;
        }
        
        .wind-indicator {
            background: rgba(135, 206, 235, 0.2);
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            text-align: center;
        }
        
        .wind-arrow {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
            transform: rotate(45deg);
            transition: transform 0.5s ease;
        }
        
        .wind-strength {
            font-weight: 600;
            color: var(--primary-green);
        }
        
        .enhanced-dice-display {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1.5rem 0;
        }
        
        .enhanced-dice {
            width: 60px;
            height: 60px;
            background: var(--white);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
        }
        
        .enhanced-dice.green {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: var(--white);
        }
        
        .enhanced-dice.red {
            background: linear-gradient(135deg, #F44336, #C62828);
            color: var(--white);
        }
        
        .enhanced-dice.rolling {
            animation: enhanced-roll 0.8s ease-in-out;
        }
        
        @keyframes enhanced-roll {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1.2); }
            75% { transform: rotate(270deg) scale(1.1); }
        }
        
        .dice-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--gray-medium);
            white-space: nowrap;
        }
        
        .enhanced-shot-button {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .enhanced-shot-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .enhanced-shot-button:hover::before {
            left: 100%;
        }
        
        .enhanced-shot-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .enhanced-shot-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .trajectory-preview {
            background: rgba(255,255,255,0.95);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        
        .trajectory-preview.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-mini {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-mini {
            text-align: center;
            padding: 1rem;
            background: var(--cream);
            border-radius: 6px;
        }
        
        .stat-mini-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-green);
        }
        
        .stat-mini-label {
            font-size: 0.8rem;
            color: var(--gray-medium);
            text-transform: uppercase;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 20;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-light);
            border-top: 3px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 1400px) {
            .enhanced-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .enhanced-panel {
                order: -1;
            }
            
            .course-3d-viewport {
                height: 500px;
            }
        }
        
        /* Visual Settings Styles */
        .visual-settings {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .setting-toggle:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .setting-toggle input[type="checkbox"] {
            display: none;
        }
        
        .toggle-slider {
            position: relative;
            width: 40px;
            height: 20px;
            background: #ccc;
            border-radius: 10px;
            transition: background-color 0.3s;
        }
        
        .toggle-slider:before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            background: white;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .setting-toggle input:checked + .toggle-slider {
            background: var(--primary-green);
        }
        
        .setting-toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        .toggle-label {
            font-size: 0.9rem;
            color: var(--gray-dark);
            user-select: none;
        }
        
        /* Accessibility Enhancements */
        .course-3d-viewport:focus {
            outline: 3px solid var(--primary-green);
            outline-offset: 2px;
        }
        
        .enhanced-dice:focus {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }
        
        /* High Contrast Mode */
        body.high-contrast {
            --primary-green: #000000;
            --light-green: #FFFFFF;
            --dark-green: #000000;
            --gold: #FFFF00;
        }
        
        body.high-contrast .course-3d-viewport {
            border: 3px solid #000000;
        }
        
        /* Colorblind Mode */
        body.colorblind-mode {
            --primary-green: #0077BE;
            --light-green: #87CEEB;
            --dark-green: #003F5C;
        }
        
        @media (max-width: 768px) {
            .enhanced-game-container {
                padding: 0.5rem;
            }
            
            .enhanced-header {
                padding: 1rem;
            }
            
            .enhanced-title {
                font-size: 1.8rem;
            }
            
            .viewport-overlay {
                flex-direction: column;
                gap: 1rem;
            }
            
            .mode-options {
                grid-template-columns: 1fr;
            }
            
            .visual-settings {
                gap: 0.5rem;
            }
            
            .toggle-label {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="enhanced-game-container">
        <div class="enhanced-header">
            <h1 class="enhanced-title">🎲 In Pursuit of Par</h1>
            <p class="enhanced-subtitle">Colonist.io-Inspired Golf Course Visualization - TPC Sawgrass Stadium Course</p>
            <div class="game-navigation" style="margin-top: 1rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="index.html" class="btn btn-secondary">📊 Scorecard</a>
                <a href="game.html" class="btn btn-secondary">🎮 Classic Game</a>
                <a href="rules.html" class="btn btn-info">📖 Rules</a>
                <a href="test.html" class="btn btn-secondary">🧪 Tests</a>
            </div>
            <div class="performance-indicator">
                <div class="performance-dot"></div>
                <span>Colonist.io-Inspired Visuals Active</span>
            </div>
            <div class="accessibility-info" style="margin-top: 1rem; font-size: 0.8rem; color: rgba(255,255,255,0.8);">
                Accessibility: Ctrl+H (Hex Grid) | Ctrl+C (Colorblind) | Ctrl+K (High Contrast)
            </div>
            <div style="margin-top: 1rem;">
                <button id="startTutorial" class="btn btn-warning" style="background: #FF9800; border-color: #E68900;">
                    📚 Start Tutorial - Learn 1987 Board Game Rules
                </button>
                <button id="quickHelp" class="btn btn-info" style="margin-left: 0.5rem;">
                    ❓ Quick Help
                </button>
            </div>
        </div>
        
        <div class="enhanced-layout">
            <div class="course-3d-area">
                <div class="course-3d-viewport" id="course3DViewport" 
                     data-intro="Welcome to TPC Sawgrass! This is your golf course view showing the authentic 1987 board game layout. You'll see your ball (white circle), the hole with TPC flag, water hazards, bunkers, and yardage markers - all exactly as designed 38 years ago." 
                     data-step="2">
                    <div class="loading-overlay" id="loadingOverlay">
                        <div style="text-align: center;">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 1rem; color: var(--primary-green); font-weight: 600;">Loading 3D Course...</p>
                        </div>
                    </div>
                    
                    <div class="viewport-overlay">
                        <div class="hole-info-3d">
                            <div class="hole-number" style="font-size: 2rem; font-weight: 700; color: var(--primary-green); margin-bottom: 0.5rem;" id="currentHole3D">1</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; font-size: 0.9rem;">
                                <div>
                                    <div style="color: var(--gray-medium); font-size: 0.7rem;">PAR</div>
                                    <div style="font-weight: 600;" id="holePar3D">4</div>
                                </div>
                                <div>
                                    <div style="color: var(--gray-medium); font-size: 0.7rem;">YARDS</div>
                                    <div style="font-weight: 600;" id="holeYardage3D">394</div>
                                </div>
                                <div>
                                    <div style="color: var(--gray-medium); font-size: 0.7rem;">DIFF</div>
                                    <div style="font-weight: 600;" id="holeDifficulty3D">#13</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="camera-controls">
                            <button class="camera-btn" id="cameraOverhead">📐 Overhead</button>
                            <button class="camera-btn" id="cameraBehindBall">🎯 Behind Ball</button>
                            <button class="camera-btn" id="cameraGreen">🏁 Green</button>
                            <button class="camera-btn" id="cameraFree">🔄 Free</button>
                        </div>
                    </div>
                </div>
                
                <div class="trajectory-preview" id="trajectoryPreview">
                    <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-green);">Shot Preview</h4>
                    <p style="margin: 0; font-size: 0.9rem; color: var(--gray-dark);" id="trajectoryText">Hover over clubs to see shot preview</p>
                </div>
            </div>
            
            <div class="enhanced-panel">
                <div class="game-mode-selector">
                    <div class="mode-title">🎮 Game Mode</div>
                    <div class="mode-options">
                        <div class="mode-option selected" data-mode="authentic">📜 Authentic 1987</div>
                        <div class="mode-option" data-mode="enhanced">✨ Enhanced 3D</div>
                    </div>
                </div>
                
                <div class="enhanced-controls">
                    <div class="control-group">
                        <div class="control-group-title">
                            🏌️ Club Selection
                        </div>
                        <div class="club-selector" id="clubSelector3D"
                             data-intro="Choose your golf club based on distance and lie conditions. Each club has authentic 1987 yardage ranges: Driver (220-270y), 7-Iron (120-140y), Wedge (50-80y). Available clubs change based on where your ball lies!" 
                             data-step="4">
                            <div class="club-option" data-club="driver">Driver</div>
                            <div class="club-option" data-club="3wood">3 Wood</div>
                            <div class="club-option" data-club="5wood">5 Wood</div>
                            <div class="club-option" data-club="3iron">3 Iron</div>
                            <div class="club-option" data-club="5iron">5 Iron</div>
                            <div class="club-option" data-club="7iron">7 Iron</div>
                            <div class="club-option" data-club="9iron">9 Iron</div>
                            <div class="club-option" data-club="wedge">Wedge</div>
                            <div class="club-option" data-club="putter">Putter</div>
                        </div>
                        
                        <div class="shot-power-control">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Shot Power</label>
                            <div class="power-meter">
                                <div class="power-fill" id="powerFill"></div>
                            </div>
                            <div class="power-labels">
                                <span>Soft</span>
                                <span>Normal</span>
                                <span>Full</span>
                            </div>
                            <input type="range" id="powerSlider" min="25" max="100" value="75" style="width: 100%; margin-top: 0.5rem;">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-group-title">
                            🎨 Visual Settings
                        </div>
                        <div class="visual-settings"
                             data-intro="Visual enhancements: Hex Grid creates the board game feel (like Colonist.io), Colorblind mode adjusts colors for accessibility, High Contrast mode improves visibility. All preserve the authentic 1987 mechanics!" 
                             data-step="5">
                            <label class="setting-toggle">
                                <input type="checkbox" id="enableHexGrid" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Hex Grid Overlay</span>
                            </label>
                            <label class="setting-toggle">
                                <input type="checkbox" id="colorBlindMode">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Colorblind Friendly</span>
                            </label>
                            <label class="setting-toggle">
                                <input type="checkbox" id="highContrastMode">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">High Contrast</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-group-title">
                            🌬️ Course Conditions
                        </div>
                        <div class="wind-indicator">
                            <span class="wind-arrow" id="windArrow">↗</span>
                            <div class="wind-strength" id="windStrength">5 mph</div>
                            <div style="font-size: 0.8rem; color: var(--gray-medium); margin-top: 0.25rem;">NE Wind</div>
                        </div>
                        
                        <div class="stats-mini">
                            <div class="stat-mini">
                                <div class="stat-mini-value" id="temperature">72°</div>
                                <div class="stat-mini-label">Temperature</div>
                            </div>
                            <div class="stat-mini">
                                <div class="stat-mini-value" id="humidity">45%</div>
                                <div class="stat-mini-label">Humidity</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-group-title">
                            🎲 Authentic Dice Roll
                        </div>
                        <div class="enhanced-dice-display"
                             data-intro="The heart of the 1987 board game! Green dice (6-sided) determines distance, Direction dice (12-sided) controls accuracy - 1-6 = left hook, 7-12 = right slice, 6-7 = straight. Problem dice appears for bad lies with penalties." 
                             data-step="3">
                            <div class="enhanced-dice green" id="greenDice3D">
                                ?
                                <div class="dice-label">Distance</div>
                            </div>
                            <div class="enhanced-dice green" id="directionDice3D">
                                ?
                                <div class="dice-label">Direction</div>
                            </div>
                            <div class="enhanced-dice red" id="problemDice3D" style="display: none;">
                                ?
                                <div class="dice-label">Problem</div>
                            </div>
                        </div>
                        
                        <button class="enhanced-shot-button" id="takeShot3D"
                                data-intro="Ready to take your shot? This button rolls the authentic 1987 dice, calculates your shot result using original board game mechanics, and moves your ball to the new position. Watch the lie conditions change!" 
                                data-step="6">
                            🏌️ Take Shot
                        </button>
                    </div>
                </div>
                
                <div class="game-status"
                     data-intro="Your current game status shows: Player name, stroke count, distance to pin (updated in real-time), and lie condition (Tee/Fairway/Rough/Sand/Green). The lie determines which clubs you can use - authentic 1987 restrictions!" 
                     data-step="7">
                    <div class="control-title">📊 Current Status</div>
                    <div class="status-item">
                        <span class="status-label">Player:</span>
                        <span class="status-value" id="currentPlayer3D">Player 1</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Strokes:</span>
                        <span class="status-value" id="currentStrokes3D">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Distance to Pin:</span>
                        <span class="status-value" id="distanceToPin3D">394 yards</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Lie:</span>
                        <span class="status-value" id="currentLie3D">Tee</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn btn-secondary" style="flex: 1;" id="undoShot3D">↶ Undo</button>
                    <button class="btn btn-primary" style="flex: 1;" id="nextHole3D">Next Hole ➤</button>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: var(--cream); border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-green);">🔄 Units & Settings</h4>
                    <button id="unitsToggle" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.5rem;">
                        Toggle Units (Yards ⇄ Meters)
                    </button>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="exportSettings" class="btn btn-secondary" style="flex: 1; font-size: 0.8rem;">Export</button>
                        <button id="importSettings" class="btn btn-secondary" style="flex: 1; font-size: 0.8rem;">Import</button>
                    </div>
                    <input type="file" id="settingsFileInput" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load external dependencies first -->
    <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
    
    <!-- Load dependencies in correct order -->
    <script>
        // Global dependency loading with error handling
        window.dependenciesLoaded = {
            phaser: false,
            intro: false,
            authentic: false,
            bridge: false,
            holeData: false,
            holeDisplay: false,
            engine: false
        };
        
        window.checkAllDependenciesLoaded = function() {
            return Object.values(window.dependenciesLoaded).every(loaded => loaded);
        };
        
        window.onDependencyLoaded = function(name) {
            window.dependenciesLoaded[name] = true;
            console.log(`✓ Loaded: ${name} (${Object.values(window.dependenciesLoaded).filter(Boolean).length}/7)`);
            
            if (window.checkAllDependenciesLoaded()) {
                console.log('✓ All dependencies loaded successfully');
                if (typeof window.initializeGame === 'function') {
                    window.initializeGame();
                } else {
                    console.error('initializeGame function not found');
                }
            }
        };
        
        window.onDependencyError = function(name, error) {
            console.error(`✗ Failed to load: ${name}`, error);
            // Hide loading overlay and show error
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.innerHTML = `
                    <div style="color: #dc2626; text-align: center;">
                        <h3>⚠️ Loading Error</h3>
                        <p>Failed to load ${name}. Please refresh the page or check your internet connection.</p>
                        <button onclick="location.reload()" style="padding: 8px 16px; margin-top: 16px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            🔄 Refresh Page
                        </button>
                    </div>
                `;
            }
        };
    </script>
    
    <!-- Load Phaser.js CDN with error handling -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js" 
            onload="window.onDependencyLoaded('phaser')" 
            onerror="window.onDependencyError('phaser', event)"></script>
    
    <!-- Load Intro.js with error handling -->
    <script src="https://unpkg.com/intro.js/minified/intro.min.js"
            onload="window.onDependencyLoaded('intro')" 
            onerror="window.onDependencyError('intro', event)"></script>
    
    <!-- Load game dependencies in order -->
    <script src="authentic-mechanics.js"
            onload="window.onDependencyLoaded('authentic')" 
            onerror="window.onDependencyError('authentic-mechanics', event)"></script>
    <script src="board-game-bridge.js"
            onload="window.onDependencyLoaded('bridge')" 
            onerror="window.onDependencyError('board-game-bridge', event)"></script>
    <script src="tpc-hole-data.js"
            onload="window.onDependencyLoaded('holeData')" 
            onerror="window.onDependencyError('tpc-hole-data', event)"></script>
    <script src="hole-display-system.js"
            onload="window.onDependencyLoaded('holeDisplay')" 
            onerror="window.onDependencyError('hole-display-system', event)"></script>
    <script src="phaser-engine.js"
            onload="window.onDependencyLoaded('engine')" 
            onerror="window.onDependencyError('phaser-engine', event)"></script>
    <script>
        // Game initialization function called when all dependencies are loaded
        window.initializeGame = function() {
            console.log('🎮 Initializing game with all dependencies loaded...');
            
            // Verify all required classes exist
            const requiredClasses = [
                'Phaser', 'introJs', 'AuthenticDiceSystem', 'BoardGameShotCalculator', 
                'TPCHoleData', 'TPCHoleDisplaySystem', 'PhaserBoardGameEngine'
            ];
            
            const missingClasses = requiredClasses.filter(className => !window[className]);
            if (missingClasses.length > 0) {
                console.error('✗ Missing required classes:', missingClasses);
                return;
            }
            
            try {
                // Initialize the Phaser engine with authentic mechanics
                window.phaserEngine = new PhaserBoardGameEngine();
                console.log('✓ Phaser engine created');
                
                // Initialize game systems after all classes are loaded
                if (window.phaserEngine.initializeGameSystems) {
                    window.phaserEngine.initializeGameSystems();
                    console.log('✓ Game systems initialized');
                }
                
                // Initialize the scene after classes are loaded
                if (window.phaserEngine.initializeScene) {
                    window.phaserEngine.initializeScene();
                    console.log('✓ Scene initialized');
                }
                
                // Initialize club availability based on starting position
                if (window.phaserEngine.updateClubAvailability) {
                    setTimeout(() => {
                        window.phaserEngine.updateClubAvailability();
                        console.log('✓ Initial club availability set for tee position');
                    }, 100);
                }

                // Initialize TPC Sawgrass hole display system
                try {
                    const holeData = new TPCHoleData();
                    const holeDisplay = new TPCHoleDisplaySystem(window.phaserEngine, holeData);
                    window.tpcHoleDisplay = holeDisplay;
                    console.log('✓ TPC Sawgrass hole display system initialized');
                } catch (error) {
                    console.warn('TPC hole display system initialization failed:', error);
                }
                
                // Try to load saved game state
                const savedGameLoaded = window.phaserEngine.loadGameState();
                if (savedGameLoaded) {
                    console.log('🔄 Restored previous game session');
                    // Show restore notification
                    showGameRestoreNotification();
                }
                
                // Setup enhanced UI interactions
                setupEnhanced3DUI();
                setupAccessibilityControls();
                
                // Hide loading overlay after successful initialization
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    console.log('✅ Game fully initialized and ready to play!');
                }, 500);
                
            } catch (error) {
                console.error('✗ Game initialization failed:', error);
                // Show error to user
                const errorOverlay = document.getElementById('loadingOverlay');
                if (errorOverlay) {
                    errorOverlay.innerHTML = `
                        <div style="color: #dc2626; text-align: center;">
                            <h3>⚠️ Initialization Error</h3>
                            <p>Failed to start the game. Please refresh the page.</p>
                            <button onclick="location.reload()" style="padding: 8px 16px; margin-top: 16px;">
                                🔄 Refresh Page
                            </button>
                        </div>
                    `;
                }
            }
        };
        
        // Initialize when DOM is ready (fallback if dependency system fails)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🎮 DOM ready, waiting for dependencies...');
            
            // If dependencies aren't loaded after 5 seconds, show progress and try anyway after 10 seconds
            setTimeout(() => {
                const loaded = Object.values(window.dependenciesLoaded).filter(Boolean).length;
                console.log(`⏳ Progress: ${loaded}/7 dependencies loaded`);
                
                if (!window.checkAllDependenciesLoaded()) {
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if (loadingOverlay) {
                        loadingOverlay.innerHTML = `
                            <div style="text-align: center;">
                                <div class="loading-spinner" style="margin: 2rem auto;"></div>
                                <h3 style="color: #1a5f3f; margin-bottom: 1rem;">Loading Dependencies...</h3>
                                <p style="color: #666;">Progress: ${loaded}/7 components loaded</p>
                                <p style="font-size: 0.9rem; color: #888; margin-top: 1rem;">
                                    This may take a moment on slower connections...
                                </p>
                            </div>
                        `;
                    }
                }
            }, 5000);
            
            // If dependencies aren't loaded after 15 seconds, try anyway
            setTimeout(() => {
                if (!window.checkAllDependenciesLoaded()) {
                    console.warn('⚠️ Not all dependencies loaded after 15s, attempting initialization anyway...');
                    try {
                        window.initializeGame();
                    } catch (error) {
                        console.error('Failed to initialize game even with fallback:', error);
                        // Force hide loading overlay
                        const overlay = document.getElementById('loadingOverlay');
                        if (overlay) {
                            overlay.innerHTML = `
                                <div style="text-align: center; color: #dc2626;">
                                    <h3>⚠️ Loading Issue</h3>
                                    <p>The game encountered loading issues.</p>
                                    <button onclick="forceStart()" style="background: #1a5f3f; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin: 1rem; cursor: pointer;">
                                        🚀 Start Game Anyway
                                    </button>
                                    <button onclick="location.reload()" style="background: #dc2626; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin: 1rem; cursor: pointer;">
                                        🔄 Refresh Page
                                    </button>
                                </div>
                            `;
                        }
                    }
                }
            }, 8000); // Reduced from 15s to 8s
            
            // Force start function for emergency bypass
            window.forceStart = function() {
                console.log('🚀 Force starting game...');
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Initialize basic game functionality
                try {
                    if (window.PhaserBoardGameEngine) {
                        window.phaserEngine = new PhaserBoardGameEngine();
                        console.log('✓ Emergency game initialization successful');
                    } else {
                        console.warn('PhaserBoardGameEngine not available, showing basic interface');
                    }
                } catch (error) {
                    console.error('Emergency initialization failed:', error);
                }
            };
        });
        
        function setupAccessibilityControls() {
            // Hex grid toggle
            document.getElementById('enableHexGrid')?.addEventListener('change', (e) => {
                if (window.phaserEngine?.currentScene?.toggleHexGrid) {
                    window.phaserEngine.currentScene.toggleHexGrid();
                }
            });
            
            // Colorblind mode toggle
            document.getElementById('colorBlindMode')?.addEventListener('change', (e) => {
                document.body.classList.toggle('colorblind-mode', e.target.checked);
                if (window.phaserEngine?.currentScene?.toggleColorBlindMode) {
                    window.phaserEngine.currentScene.toggleColorBlindMode();
                }
            });
            
            // High contrast toggle
            document.getElementById('highContrastMode')?.addEventListener('change', (e) => {
                document.body.classList.toggle('high-contrast', e.target.checked);
                if (window.phaserEngine?.currentScene?.toggleHighContrast) {
                    window.phaserEngine.currentScene.toggleHighContrast();
                }
            });
            
            // Keyboard accessibility
            document.addEventListener('keydown', (e) => {
                if (e.key === 'h' && e.ctrlKey) {
                    e.preventDefault();
                    document.getElementById('enableHexGrid')?.click();
                }
                if (e.key === 'c' && e.ctrlKey) {
                    e.preventDefault();
                    document.getElementById('colorBlindMode')?.click();
                }
                if (e.key === 'k' && e.ctrlKey) {
                    e.preventDefault();
                    document.getElementById('highContrastMode')?.click();
                }
            });
        }
        
        function setupEnhanced3DUI() {
            // Power slider updates
            const powerSlider = document.getElementById('powerSlider');
            const powerFill = document.getElementById('powerFill');
            
            powerSlider?.addEventListener('input', (e) => {
                const power = e.target.value;
                powerFill.style.width = `${power}%`;
            });
            
            // Club hover preview
            document.querySelectorAll('.club-option').forEach(club => {
                club.addEventListener('mouseenter', () => {
                    showTrajectoryPreview(club.dataset.club);
                });
                
                club.addEventListener('mouseleave', () => {
                    hideTrajectoryPreview();
                });
            });
            
            // Camera controls - adapted for Phaser 2D views
            document.getElementById('cameraOverhead')?.addEventListener('click', () => {
                window.phaserEngine?.currentScene?.cameras?.main?.setZoom(0.5);
            });
            
            document.getElementById('cameraBehindBall')?.addEventListener('click', () => {
                window.phaserEngine?.currentScene?.cameras?.main?.setZoom(1.0);
            });
            
            document.getElementById('cameraGreen')?.addEventListener('click', () => {
                window.phaserEngine?.currentScene?.cameras?.main?.centerOn(400, 90);
            });
            
            document.getElementById('cameraFree')?.addEventListener('click', () => {
                window.phaserEngine?.currentScene?.cameras?.main?.setZoom(0.8);
            });
            
            // Mode selection
            document.querySelectorAll('.mode-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.mode-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    const mode = option.dataset.mode;
                    console.log(`Game mode changed to: ${mode}`);
                });
            });
            
            // Setup shot button
            const shotButton = document.getElementById('takeShot3D');
            shotButton?.addEventListener('click', () => {
                if (window.phaserEngine && typeof window.phaserEngine.takeShot === 'function') {
                    try {
                        window.phaserEngine.takeShot();
                        console.log('✓ Shot executed successfully');
                    } catch (error) {
                        console.error('✗ Shot execution failed:', error.message);
                    }
                } else {
                    console.warn('⚠️ Shot execution not available yet');
                }
            });
            
            // Setup club selection
            document.querySelectorAll('.club-option').forEach(club => {
                club.addEventListener('click', () => {
                    // Remove selected class from all clubs
                    document.querySelectorAll('.club-option').forEach(c => c.classList.remove('selected'));
                    // Add selected class to clicked club
                    club.classList.add('selected');
                    
                    if (window.phaserEngine && typeof window.phaserEngine.selectClub === 'function') {
                        try {
                            window.phaserEngine.selectClub(club.dataset.club);
                            console.log(`✓ Club selected: ${club.dataset.club}`);
                        } catch (error) {
                            console.error('✗ Club selection failed:', error.message);
                        }
                    }
                });
            });
            
            // Simulate dynamic wind
            simulateWeatherEffects();
            
            // Setup units and settings controls
            setupUnitsAndSettings();
        }
        
        function setupUnitsAndSettings() {
            // Units toggle button
            document.getElementById('unitsToggle')?.addEventListener('click', () => {
                window.phaserEngine?.toggleUnits();
            });
            
            // Export settings button
            document.getElementById('exportSettings')?.addEventListener('click', () => {
                window.phaserEngine?.exportSettings();
            });
            
            // Import settings button
            document.getElementById('importSettings')?.addEventListener('click', () => {
                document.getElementById('settingsFileInput').click();
            });
            
            // File input for settings import
            document.getElementById('settingsFileInput')?.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    window.phaserEngine?.importSettings(file);
                }
                // Reset file input
                e.target.value = '';
            });
        }
        
        function showTrajectoryPreview(club) {
            const preview = document.getElementById('trajectoryPreview');
            const text = document.getElementById('trajectoryText');
            
            // Get shot data for preview from Phaser engine
            const clubDistances = {
                'driver': '220-270', '3wood': '200-240', '5wood': '180-210',
                '3iron': '160-180', '5iron': '140-160', '7iron': '120-140',
                '9iron': '100-120', 'wedge': '50-80', 'putter': '10-30'
            };
            
            const distance = clubDistances[club] || '100-150';
            text.textContent = `${club.toUpperCase()}: ${distance} yards, authentic board game mechanics`;
            preview.classList.add('show');
        }
        
        function hideTrajectoryPreview() {
            document.getElementById('trajectoryPreview').classList.remove('show');
        }
        
        function simulateWeatherEffects() {
            const windArrow = document.getElementById('windArrow');
            const windStrength = document.getElementById('windStrength');
            const temperature = document.getElementById('temperature');
            const humidity = document.getElementById('humidity');
            
            // Update weather every 30 seconds
            setInterval(() => {
                // Wind direction (8 directions)
                const directions = ['↑', '↗', '→', '↘', '↓', '↙', '←', '↖'];
                const randomDir = directions[Math.floor(Math.random() * directions.length)];
                windArrow.textContent = randomDir;
                
                // Wind strength (0-15 mph)
                const strength = Math.floor(Math.random() * 16);
                windStrength.textContent = `${strength} mph`;
                
                // Temperature (65-85°F)
                const temp = Math.floor(Math.random() * 21) + 65;
                temperature.textContent = `${temp}°`;
                
                // Humidity (30-70%)
                const hum = Math.floor(Math.random() * 41) + 30;
                humidity.textContent = `${hum}%`;
            }, 30000);
        }
        
        // Tutorial System - Authentic 1987 Board Game Education
        function initializeTutorialSystem() {
            // Configure Intro.js with 1987 board game theme
            introJs().setOptions({
                nextLabel: 'Next Step →',
                prevLabel: '← Previous',
                skipLabel: 'Skip Tutorial',
                doneLabel: 'Start Playing! 🏌️',
                exitOnOverlayClick: false,
                showStepNumbers: true,
                tooltipClass: 'authentic-tutorial-tooltip',
                highlightClass: 'authentic-tutorial-highlight'
            });
            
            // Tutorial step 1 - Welcome (triggered manually)
            const welcomeStep = {
                intro: `
                    <div style="text-align: center;">
                        <h3>🎲 Welcome to "In Pursuit of Par" 🎲</h3>
                        <p>This is an <strong>authentic recreation</strong> of the 1987 board game!</p>
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='40' viewBox='0 0 60 40'><rect width='60' height='40' fill='%234CAF50'/><text x='30' y='25' text-anchor='middle' fill='white' font-size='12'>1987</text></svg>" style="margin: 10px;">
                        <p>Every dice roll, distance calculation, and club restriction is <strong>exactly as designed 38 years ago</strong>.</p>
                        <p>Ready to learn the authentic board game mechanics?</p>
                    </div>
                `
            };
            
            // Add CSS for tutorial styling
            const tutorialStyles = document.createElement('style');
            tutorialStyles.innerHTML = `
                .authentic-tutorial-tooltip {
                    background: linear-gradient(135deg, #4CAF50, #2E7D32) !important;
                    color: white !important;
                    border: 2px solid #FFD700 !important;
                    border-radius: 12px !important;
                    font-family: 'Inter', sans-serif !important;
                    box-shadow: 0 8px 24px rgba(0,0,0,0.3) !important;
                }
                
                .authentic-tutorial-tooltip .introjs-tooltip-title {
                    color: #FFD700 !important;
                    font-weight: bold !important;
                    border-bottom: 2px solid #FFD700 !important;
                    padding-bottom: 8px !important;
                    margin-bottom: 12px !important;
                }
                
                .authentic-tutorial-highlight {
                    border: 3px solid #FFD700 !important;
                    border-radius: 8px !important;
                    box-shadow: 0 0 15px #FFD700 !important;
                }
                
                .introjs-button {
                    background: #FFD700 !important;
                    color: #2E7D32 !important;
                    border: none !important;
                    border-radius: 6px !important;
                    font-weight: bold !important;
                    padding: 8px 16px !important;
                    margin: 4px !important;
                }
                
                .introjs-button:hover {
                    background: #FFC107 !important;
                    transform: translateY(-1px) !important;
                }
            `;
            document.head.appendChild(tutorialStyles);
            
            // Tutorial event handlers
            document.getElementById('startTutorial')?.addEventListener('click', () => {
                startFullTutorial();
            });
            
            document.getElementById('quickHelp')?.addEventListener('click', () => {
                showQuickHelp();
            });
            
            // Check if first visit
            if (!localStorage.getItem('tutorial-completed')) {
                // Auto-start tutorial for first-time users after game loads
                setTimeout(() => {
                    if (confirm('Welcome to the 1987 board game recreation! Would you like to start the tutorial to learn the authentic mechanics?')) {
                        startFullTutorial();
                    }
                }, 3000);
            }
        }
        
        function startFullTutorial() {
            // Ensure game is loaded first
            if (!window.phaserEngine) {
                alert('Please wait for the game to finish loading, then try the tutorial again.');
                return;
            }
            
            // Custom intro step for welcome
            introJs().setOption('steps', [{
                intro: `
                    <div style="text-align: center; padding: 20px;">
                        <h2 style="color: #4CAF50; margin-bottom: 15px;">🎲 Authentic 1987 Board Game 🎲</h2>
                        <p style="font-size: 16px; margin-bottom: 15px;">Welcome to <strong>"In Pursuit of Par"</strong></p>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p><strong>🏌️ This is a pixel-perfect recreation of the 1987 board game!</strong></p>
                            <p>• Every dice mechanic is authentic<br>
                            • All club distances match original charts<br>
                            • Lie restrictions exactly as designed<br>
                            • TPC Sawgrass hole layout</p>
                        </div>
                        <p style="color: #666;">Let's learn how to play the way golfers did in 1987!</p>
                    </div>
                `,
                position: 'bottom'
            }]).start().oncomplete(() => {
                // Continue with main tutorial
                introJs().start();
            });
        }
        
        function showQuickHelp() {
            const helpContent = `
                <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                    <h3>🎲 Quick Reference - 1987 Board Game Rules</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div style="background: #f0f8ff; padding: 10px; border-radius: 6px;">
                            <h4>🎯 Dice System</h4>
                            <p><strong>Green (6-sided):</strong> Distance<br>
                            <strong>Direction (12-sided):</strong><br>
                            1-6 = Hook left<br>
                            7-12 = Slice right<br>
                            <strong>Problem (6-sided):</strong> Penalties</p>
                        </div>
                        <div style="background: #f0fff0; padding: 10px; border-radius: 6px;">
                            <h4>🏌️ Club Ranges</h4>
                            <p><strong>Driver:</strong> 220-270y<br>
                            <strong>7-Iron:</strong> 120-140y<br>
                            <strong>Wedge:</strong> 50-80y<br>
                            <strong>Putter:</strong> 10-30y</p>
                        </div>
                        <div style="background: #fff8f0; padding: 10px; border-radius: 6px;">
                            <h4>📍 Lie Conditions</h4>
                            <p><strong>Tee:</strong> All clubs<br>
                            <strong>Fairway:</strong> No driver<br>
                            <strong>Rough:</strong> Irons only<br>
                            <strong>Sand:</strong> Wedge/Putter<br>
                            <strong>Green:</strong> Putter mainly</p>
                        </div>
                        <div style="background: #f8f0ff; padding: 10px; border-radius: 6px;">
                            <h4>🏆 Scoring</h4>
                            <p><strong>Par 4:</strong> 4 strokes<br>
                            <strong>Gimme:</strong> Within 3 feet<br>
                            <strong>Birdie:</strong> 1 under par<br>
                            <strong>Eagle:</strong> 2 under par</p>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <p style="color: #666; font-style: italic;">Click anywhere to close</p>
                    </div>
                </div>
            `;
            
            // Create modal overlay
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 3000;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 30px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                cursor: default;
            `;
            
            content.innerHTML = helpContent;
            content.addEventListener('click', (e) => e.stopPropagation());
            
            modal.appendChild(content);
            modal.addEventListener('click', () => modal.remove());
            
            document.body.appendChild(modal);
        }
        
        // Show game restore notification
        function showGameRestoreNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                z-index: 10000;
                font-family: Inter, sans-serif;
                font-size: 0.9rem;
                animation: slideInRight 0.5s ease;
                cursor: pointer;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="font-size: 1.2rem;">🔄</span>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Game Restored!</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Previous game session loaded</div>
                    </div>
                    <button onclick="window.phaserEngine.clearSavedGame(); location.reload();" 
                            style="background: none; border: none; color: white; font-size: 0.8rem; opacity: 0.8; margin-left: 1rem; cursor: pointer;"
                            title="Start new game">
                        ✕ New Game
                    </button>
                </div>
                <style>
                    @keyframes slideInRight {
                        from { transform: translateX(100%); }
                        to { transform: translateX(0); }
                    }
                </style>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.5s ease reverse';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // Initialize tutorial system when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeTutorialSystem();
        });
    </script>
</body>
</html>